{"componentChunkName":"component---src-templates-blog-post-js","path":"/ブログ/GatsbyJSのソースをpushしたら自動でビルドしてGithub Pagesにデプロイする/","result":{"data":{"site":{"siteMetadata":{"title":"悪魔のオコトバ"}},"markdownRemark":{"id":"be6eec13-caf6-5543-ba10-003256cb548c","excerpt":"GatsbyJSでブログ記事を書いてgh-pages（参考:GatsbyJSのサイトをGithub Pagesで公開する）でGithub Pagesにデプロイしていましたが、ソースファイルのPushとデプロイを別でやらなきゃいけないのは大変だったので、Pushしたら自動でデプロイできるように設定しました。 Github…","html":"<p>GatsbyJSでブログ記事を書いてgh-pages（参考:<a href=\"../GatsbyJS%E3%81%AE%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92Github_Pages%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B/\">GatsbyJSのサイトをGithub Pagesで公開する</a>）でGithub Pagesにデプロイしていましたが、ソースファイルのPushとデプロイを別でやらなきゃいけないのは大変だったので、Pushしたら自動でデプロイできるように設定しました。<br>\nGithub Actionsという機能で実現できるようです。</p>\n<h2>やること</h2>\n<ul>\n<li>Github Actionsで使用するアクセストークンを準備</li>\n<li>Github Actionsを設定</li>\n</ul>\n<h2>構成</h2>\n<ul>\n<li>Github Pagesのユーザーページ（アドレスが<code class=\"language-text\">https://username.github.io</code>）でサイトを公開</li>\n<li>ソースは<code class=\"language-text\">source</code>リポジトリで管理</li>\n</ul>\n<h2>アクセストークンの準備</h2>\n<h2>トークンの作成</h2>\n<p>Github右上ののユーザーアイコンから<code class=\"language-text\">Settings &gt; Developer settings &gt; Personal access tokens</code>にて、Actionで使用するアクセストークンを生成します。  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7916b2edf606a5886d8bdbce632376ac/54bf4/generateAccessToken.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4UlEQVQY022R2W4FIQxD+f//7Etb9oSdcc1Mn64G6QgJxY4TjLSNpAMpRTgfUFvD29nXheuDt2PGvBB0Y+3n4RTmLLDOw7OBtQ699w/ZYyai+P6xsKzTmKDWw4g2fP0qMu8xBvY+hhneOThirUWM8RanlJDYzMtEn5u1+9aMObHWwuJtqgpHfdIcwUlY+4LNEzYNBIq1FKgqDdbNXBcn2mhcT2P6TtPOmsZm5m0PWipcyHBRSUFISoTpCiepNKooNMgiNye9/mPeFn12dhJl7Yg6+WkPQfh5Zd6jnoT7E+r/AAaP1I2MGFBBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"アクセストークン生成\"\n        title=\"アクセストークン生成\"\n        src=\"/static/7916b2edf606a5886d8bdbce632376ac/fcda8/generateAccessToken.png\"\n        srcset=\"/static/7916b2edf606a5886d8bdbce632376ac/12f09/generateAccessToken.png 148w,\n/static/7916b2edf606a5886d8bdbce632376ac/e4a3f/generateAccessToken.png 295w,\n/static/7916b2edf606a5886d8bdbce632376ac/fcda8/generateAccessToken.png 590w,\n/static/7916b2edf606a5886d8bdbce632376ac/efc66/generateAccessToken.png 885w,\n/static/7916b2edf606a5886d8bdbce632376ac/54bf4/generateAccessToken.png 1007w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">public_repo Access public repository</code>にチェックを入れてトークンを生成します。<br>\n生成されたトークンをコピーしておいてください。</p>\n<h2>トークンを環境変数に設定</h2>\n<p>リポジトリの<code class=\"language-text\">Settings &gt; Secrets &gt; New secret</code>から先ほどのトークンを暗号化された環境変数として登録します。<br>\n今回は<code class=\"language-text\">Name</code>は<code class=\"language-text\">ACCESS_TOKEN</code>と設定します。<code class=\"language-text\">Value</code>に先ほどコピーしたトークンをペーストして<code class=\"language-text\">Add secrets</code>を押します。  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5821dedd5f10251978702f1c0227a0c6/3dde1/registerToken.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABVUlEQVQoz42SW2/DIAyF8///2572tpepU7eubZqEWwIYOLPJpRdN6yx9ggRzMMc03gdYN8JYwcGOE5TScOPITBVZU9rWueRqY6El10muQXf4gjqfECmhCTEhREJKhMgjEUG7iMEGFjF1s2MR4mRKC0TXb5nnjJQLMtP0lnDoIwJl1CgFnYm4mAStFdr2zIIWy+LCL8H7CtMoRziryCfk+kPi+3TBbn9E2/O1A2CmAuXShmakolmn3FEFTyx4+1P80nbC5IntyJVIM2EZ84PQVXBM2F8i+zFXmLlSaVQk8fXGrwdkXTyv4zbnpijrcex9vcIqKGavzfqbdMMs2gzdgMGMmx/SKTnRL5tireY5Yam2MWNkv3y93ipQpOEMiWdPq7yn6ZTDx6HjKgM3IXLZCUfX4q17h/a2vhJ5AfkfSF5DqWCKpXZufTY7/YmX4ysGrzYr/hs/KHZd6j1SvXMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"アクセストークンを環境変数に設定\"\n        title=\"アクセストークンを環境変数に設定\"\n        src=\"/static/5821dedd5f10251978702f1c0227a0c6/fcda8/registerToken.png\"\n        srcset=\"/static/5821dedd5f10251978702f1c0227a0c6/12f09/registerToken.png 148w,\n/static/5821dedd5f10251978702f1c0227a0c6/e4a3f/registerToken.png 295w,\n/static/5821dedd5f10251978702f1c0227a0c6/fcda8/registerToken.png 590w,\n/static/5821dedd5f10251978702f1c0227a0c6/efc66/registerToken.png 885w,\n/static/5821dedd5f10251978702f1c0227a0c6/3dde1/registerToken.png 1018w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Github ActionsのWorkflowを作成</h2>\n<p>Github ActionsのWorkflowはソースのブランチの<code class=\"language-text\">.github/workflows</code>に設定を記したymlファイルを置いておくだけで機能するようです。<br>\n今回は以下の内容でymlファイルを作成しました。  </p>\n<p><em>github/workflows/Gatsby-publish.yml</em></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> source\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>マーケットプレイスで公開されている<a href=\"https://github.com/marketplace/actions/gatsby-publish\">こちら</a>のActionを呼び出しているだけです。<br>\nアクセストークンには先ほど設定した環境変数を書きます。<br>\nビルドしたファイルはデフォルトでは<code class=\"language-text\">master</code>ブランチにPushされます。変更したい場合は上記リンク参照。</p>\n<p>これだけでPushしたときに勝手にビルドしてくれます。便利！</p>","frontmatter":{"title":"GatsbyJSのソースをPushしたら自動でビルドしてGithub Pagesにデプロイする","date":"June 05, 2020","description":"GatsbyJSのソースをgitにPushしたときに自動でビルドしてGithub PagesにデプロイしてくれるようにGithub ActionsのWorkflowを設定した。","category":"ブログ"}}},"pageContext":{"slug":"/ブログ/GatsbyJSのソースをpushしたら自動でビルドしてGithub Pagesにデプロイする/","previous":{"fields":{"slug":"/ブログ/TypographyjsでGoogle_Fontsを設定する/"},"frontmatter":{"title":"TypographyjsでGoogle Fontsを設定する","category":"ブログ"}},"next":null}}}