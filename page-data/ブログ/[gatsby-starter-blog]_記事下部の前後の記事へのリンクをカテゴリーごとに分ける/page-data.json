{"componentChunkName":"component---src-templates-blog-post-js","path":"/ブログ/[gatsby-starter-blog]_記事下部の前後の記事へのリンクをカテゴリーごとに分ける/","result":{"data":{"site":{"siteMetadata":{"title":"悪魔のオコトバ"}},"markdownRemark":{"id":"9bff70f0-af47-52a8-89d4-92ae04cbd819","excerpt":"前後の記事へのリンク  gatsby-starter-blog…","html":"<h2>前後の記事へのリンク</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f430999ed722d7a4633e15cde4706a5/dc616/links.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.24324324324324%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABBElEQVQoz6VSDWuDMBT0///AgUxwFFtto4mmac33LR9G7GBjYw+Oyz3I5XzPCqG89/hPHe9XRVjn8PZ+AWUzpmkCYwyEkISix3EEpRScc/BlCf2si0fk6ig+ThfcbgRd16FpmoS6rjEMQzLu+x5t2yYeCMX5mg3L/WT4NbLWGkopCCGwrnLXxtrA+ayUhDQeT+0PZtsnB7kL/GmW/mV+e8LScIEfymJ5GtxXg+mu0VEJHs6xJ6QFexj0c0ho3IvJ0Xg31NZjWDSuAZMwuHGdQDamIpudmQQJj/HVphDfbtmFLcs0ozynuPWS3G1JCluX4X8yNMZgnueEuLm4jOOsfvMPxvoEHCfAta/Rkf8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"前後の記事へのリンク\"\n        title=\"前後の記事へのリンク\"\n        src=\"/static/5f430999ed722d7a4633e15cde4706a5/fcda8/links.png\"\n        srcset=\"/static/5f430999ed722d7a4633e15cde4706a5/12f09/links.png 148w,\n/static/5f430999ed722d7a4633e15cde4706a5/e4a3f/links.png 295w,\n/static/5f430999ed722d7a4633e15cde4706a5/fcda8/links.png 590w,\n/static/5f430999ed722d7a4633e15cde4706a5/efc66/links.png 885w,\n/static/5f430999ed722d7a4633e15cde4706a5/dc616/links.png 933w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>gatsby-starter-blogにデフォルトで実装されていた記事下部の「前後の記事へのリンク」です。<br>\nカテゴリに関係なく日付順に表示されているのですが、このブログを投稿順に読みたいというニーズは（自分を含め）皆無だと思ったので、カテゴリ内での前後の記事を表示するように修正しました。  </p>\n<p>この記事を書いている時点ではどこにもカテゴリー名は表示していないのですが、そのうちカテゴリー別の目次やまとめページを作る予定なので内部的にはカテゴリー分けをしています。（参照: <a href=\"/%E3%83%96%E3%83%AD%E3%82%B0/%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%80%E3%82%A6%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\">シェルスクリプトで記事のマークダウンファイルを作成する</a>）</p>\n<h2>現在の実装</h2>\n<p>まずは元となる現在の実装箇所を探しました。</p>\n<p><em>gatsby-node.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> previous <span class=\"token operator\">=</span> index <span class=\"token operator\">===</span> posts<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> posts<span class=\"token punctuation\">[</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>node\n    <span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> index <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> posts<span class=\"token punctuation\">[</span>index <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>node\n\n    （<span class=\"token operator\">...</span>省略）</code></pre></div>\n<p>ここで前後のページの設定をしています。<code class=\"language-text\">posts</code>は全ポストの配列で[0]から日付の降順でポストが格納されています。  </p>\n<p><code class=\"language-text\">previous</code>では、現在のポストが最初のポストの場合はnull、それ以外のときは1つ前のポストを設定しています。<br>\n<code class=\"language-text\">next</code>では、現在のポストが最新のポストの場合はnull、それ以外のときは1つ次のポストを設定しています。  </p>\n<p>記事のページではこの<code class=\"language-text\">previous</code>、<code class=\"language-text\">next</code>を参照してリンクを表示しているようです。</p>\n<h2>修正</h2>\n<p>上記のコードをカテゴリ別に表示できるようにします。</p>\n<h4>カテゴリ情報を取得する</h4>\n<p>上記コード内の<code class=\"language-text\">posts</code>は、graphQLで取得されていますが、Front Matterの<code class=\"language-text\">category</code>が指定されていないので取得されていません（勝手につけた情報なので当たり前ですが）。<br>\nなのでまずは<code class=\"language-text\">posts</code>の元となる<code class=\"language-text\">result</code>を取得する際に<code class=\"language-text\">category</code>を合わせて取得するように修正します。  </p>\n<p><em>gatsby-node.js</em>  </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    {\n      allMarkdownRemark(\n        sort: { fields: [frontmatter___date], order: DESC }\n        limit: 1000\n      ) {\n        edges {\n          node {\n            fields {\n              slug\n            }\n            frontmatter {\n              title\n              category // &lt;---New!!\n            }\n          }\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>これで先ほどの<code class=\"language-text\">post</code>から<code class=\"language-text\">category</code>を取得できるようになりました。  </p>\n<h3>ポストの設定</h3>\n<p>次は<code class=\"language-text\">previous</code>と<code class=\"language-text\">next</code>の中身をいじっていきます。</p>\n<p>行う操作は  </p>\n<p><code class=\"language-text\">previous</code>の場合</p>\n<ul>\n<li>現在のポストより過去のポストを抽出する。</li>\n<li>順番に同じカテゴリのポストが見つかるまで検索する。</li>\n</ul>\n<p><code class=\"language-text\">next</code>の場合</p>\n<ul>\n<li>現在のポストより未来のポストを抽出する。</li>\n<li>順番をリバースする。（近い方から検索するため）</li>\n<li>順番に同じカテゴリのポストが見つかるまで検索する。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> categPrevPost <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> posts<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span>\n  v<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>category <span class=\"token operator\">===</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> categNextPost <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span>\n  v<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>category <span class=\"token operator\">===</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> previous <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>categPrevPost <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> categPrevPost<span class=\"token punctuation\">.</span>node\n<span class=\"token keyword\">const</span> next <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>categNextPost <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> categNextPost<span class=\"token punctuation\">.</span>node</code></pre></div>\n<p>もっといい書き方があるかもしれません。あったら教えてください。<br>\n記事が多くなってくるとどれくらい負荷がかかるかわかりませんが、まあローカルのビルドの問題なのでとりあえずこれでよしとしましょう。</p>","frontmatter":{"title":"[gatsby-starter-blog] 記事下部の前後の記事へのリンクをカテゴリーごとに分ける","date":"June 03, 2020","description":"このブログはいずれ技術書のような読み方ができるようにしていきたいので、ページ下部のリンクをカテゴリ別に分けることにした。","category":"ブログ"}}},"pageContext":{"slug":"/ブログ/[gatsby-starter-blog]_記事下部の前後の記事へのリンクをカテゴリーごとに分ける/","previous":{"fields":{"slug":"/ブログ/GatsbyJSのコンテンツディレクトリをリネームしたらNot_Foundになった/"},"frontmatter":{"title":"GatsbyJSのコンテンツディレクトリをリネームしたらNot Foundになった","category":"ブログ"}},"next":{"fields":{"slug":"/ブログ/TypographyjsでGoogle_Fontsを設定する/"},"frontmatter":{"title":"TypographyjsでGoogle Fontsを設定する","category":"ブログ"}}}}}